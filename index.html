<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Batch Image Resizer with Original Filenames</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    label, input, button { margin: 10px 0; display: block; }
    .output { margin-top: 20px; display: flex; flex-wrap: wrap; gap: 20px; }
    .image-container { border: 1px solid #ccc; padding: 10px; text-align: center; }
    .image-container img { max-width: 200px; max-height: 200px; display: block; margin-bottom: 5px; }
    canvas { display: none; }
  </style>
</head>
<body>

<h2>Batch Image Resizer with White Border & Original Filenames</h2>

<label>Upload Images:</label>
<input type="file" id="imageInput" accept="image/*" multiple>

<label>Canvas Width (px):</label>
<input type="number" id="canvasWidth" value="800">

<label>Canvas Height (px):</label>
<input type="number" id="canvasHeight" value="800">

<label>Border Size (px):</label>
<input type="number" id="borderSize" value="10">

<button onclick="processImages()">Process Images</button>
<button id="downloadZipBtn" style="display:none;" onclick="downloadZip()">Download All as ZIP</button>

<div class="output" id="output"></div>

<canvas id="canvas"></canvas>

<script>
let processedImages = [];

function processImages() {
  const input = document.getElementById('imageInput');
  const output = document.getElementById('output');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const canvasWidth = parseInt(document.getElementById('canvasWidth').value);
  const canvasHeight = parseInt(document.getElementById('canvasHeight').value);
  const borderSize = parseInt(document.getElementById('borderSize').value);

  if (!input.files.length) {
    alert("Please select images first.");
    return;
  }

  processedImages = [];
  output.innerHTML = '';
  document.getElementById('downloadZipBtn').style.display = "none";

  Array.from(input.files).forEach((file, index) => {
    const reader = new FileReader();
    const img = new Image();
    const originalName = file.name.replace(/\.[^/.]+$/, ""); // Remove extension

    reader.onload = function(e) {
      img.onload = function() {
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvasWidth, canvasHeight);

        const maxWidth = canvasWidth - 2 * borderSize;
        const maxHeight = canvasHeight - 2 * borderSize;
        const scale = Math.min(maxWidth / img.width, maxHeight / img.height);
        const newWidth = img.width * scale;
        const newHeight = img.height * scale;
        const x = (canvasWidth - newWidth) / 2;
        const y = (canvasHeight - newHeight) / 2;

        ctx.drawImage(img, x, y, newWidth, newHeight);

        canvas.toBlob(blob => {
          const fileName = `${originalName}.jpg`;
          processedImages.push({ name: fileName, blob: blob });

          // Preview + download
          const url = URL.createObjectURL(blob);
          const container = document.createElement('div');
          container.className = 'image-container';

          const preview = document.createElement('img');
          preview.src = url;

          const downloadLink = document.createElement('a');
          downloadLink.href = url;
          downloadLink.download = fileName;
          downloadLink.innerText = 'Download';

          container.appendChild(preview);
          container.appendChild(downloadLink);
          output.appendChild(container);

          if (processedImages.length === input.files.length) {
            document.getElementById('downloadZipBtn').style.display = "inline-block";
          }
        }, 'image/jpeg', 0.9);
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });
}

function downloadZip() {
  const zip = new JSZip();
  processedImages.forEach(img => zip.file(img.name, img.blob));
  zip.generateAsync({ type: "blob" }).then(function(content) {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(content);
    a.download = "processed_images.zip";
    a.click();
  });
}
</script>

</body>
</html>
